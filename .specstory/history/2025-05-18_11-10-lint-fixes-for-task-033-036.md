<!-- Generated by SpecStory -->

# Lint Fixes for Task 033-036 (2025-05-18 07:10:52)

_**User**_

@TASK-033-036.md complete lint fixes for task 

---

_**Assistant**_



---

I'll fix the lint errors in the files mentioned. Let me handle each file systematically.

---

Could not find file 'src/components/features/SurpriseMe.tsx' in the workspace.

---

Let me read the correct files from the StreamVibe directory:

---

Read file: StreamVibe/src/components/features/SurpriseMe.tsx

---

Read file: StreamVibe/src/services/OpenAIService.ts

---

Read file: StreamVibe/src/services/PreferencesService.ts

---

Read file: StreamVibe/src/services/PreferencesService.ts

---

Read file: StreamVibe/src/services/RecommendationService.ts

---

Read file: StreamVibe/src/services/RecommendationService.ts

---

Read file: StreamVibe/src/types/Recommendation.ts

---

Now I'll fix each of the linting issues:

1. First, let's fix the SurpriseMe.tsx useEffect dependencies:

---

```diff
        generateSurpriseRecommendations();
      }
-   }, [selectedMood]);
+   }, [selectedMood, generateSurpriseRecommendations]);
    
    // Select a random featured content from recommendations when they change
```

```diff
        loadFeaturedContent();
      }
-   }, [recommendations]);
+   }, [recommendations, contentService]);
    
    const generateSurpriseRecommendations = async () => {
```

---

We need to fix the order of the functions in SurpriseMe.tsx:

---

```diff
    const contentService = ContentService.getInstance();
    const preferencesService = PreferencesService.getInstance();
+   
+   const generateSurpriseRecommendations = async () => {
+     setLoading(true);
+     
+     try {
+       const options: SurpriseRecommendationOptions = {
+         moodBased: !!selectedMood,
+         mood: selectedMood || undefined,
+         genreBlending: true,
+         excludeWatchHistory: true,
+         noveltyLevel: noveltyLevel
+       };
+       
+       const response = await recommendationService.getSurpriseRecommendations(options);
+       setRecommendations(response);
+     } catch (error) {
+       console.error('Error getting surprise recommendations:', error);
+     } finally {
+       setLoading(false);
+     }
+   };
    
    // Load surprise recommendations
```

```diff
      }
    }, [recommendations, contentService]);
-   
-   const generateSurpriseRecommendations = async () => {
-     setLoading(true);
-     
-     try {
-       const options: SurpriseRecommendationOptions = {
-         moodBased: !!selectedMood,
-         mood: selectedMood || undefined,
-         genreBlending: true,
-         excludeWatchHistory: true,
-         noveltyLevel: noveltyLevel
-       };
-       
-       const response = await recommendationService.getSurpriseRecommendations(options);
-       setRecommendations(response);
-     } catch (error) {
-       console.error('Error getting surprise recommendations:', error);
-     } finally {
-       setLoading(false);
-     }
-   };
    
    const handleMoodSelect = (mood: string) => {
```

---

Now let's fix the OpenAIService.ts any types:

---

```diff
    private baseUrl = 'https://api.openai.com/v1';
    private defaultModel = 'gpt-4o-mini';
-   private cache: Map<string, { data: any; timestamp: number }> = new Map();
+   private cache: Map<string, { data: unknown; timestamp: number }> = new Map();
    private cacheExpiryTime = 1000 * 60 * 30; // 30 minutes
  
```

```diff
     * Store data in cache
     */
-   private setCache(key: string, data: any): void {
+   private setCache(key: string, data: unknown): void {
      this.cache.set(key, {
        data,
```

---

Now let's fix the PreferencesService.ts unused variable and any type:

---

```diff
      }
      
-     // Get all content items for analysis
+     // Get all content for reference
      const allContent = await this.contentService.getAllContent();
-     
-     // Get watch history data
-     const recentlyWatched = await this.contentService.getRecentlyWatched(20);
      
      // Compile watch history data with percentages
```

```diff
    private analyzeViewingPatterns(
      watchHistory: UserPreferenceData['watchHistory'], 
-     allContent: any[]
+     allContent: ContentItem[]
    ) {
      if (watchHistory.length === 0) {
```

---

Let's add the missing import for ContentItem:

---

```diff
  import type { UserPreferenceData } from '../types/Recommendation';
  import ContentService from './ContentService';
+ import type { ContentItem } from '../types/Content';
  
  /**
```

---

Let's fix the case declarations in RecommendationService.ts:

---

```diff
      
      switch (request.contextType) {
+       case 'general':
+         userPrompt = 'Recommend content that matches my preferences.';
+         break;
        case 'genre':
          userPrompt = `Recommend content in the "${request.contextValue}" genre that matches my preferences.`;
          break;
-       case 'content':
+       case 'content': {
          const contentItem = allContent.find(item => item.id === request.contextValue);
          if (contentItem) {
            userPrompt = `Recommend content similar to "${contentItem.title}" (ID: ${contentItem.id}) that I might enjoy.`;
          }
          break;
+       }
        case 'mood':
          userPrompt = `I'm in a ${request.contextValue} mood. Recommend content that would suit this mood based on my preferences.`;
```

```diff
        // Validate and clean the recommendations
        return recommendations
-         .filter((rec: any) => {
+         .filter((rec: ContentRecommendationRaw) => {
            // Verify that the contentId exists in our content library
            return rec.contentId && allContent.some(item => item.id === rec.contentId);
          })
-         .map((rec: any) => ({
+         .map((rec: ContentRecommendationRaw) => ({
            contentId: rec.contentId,
            score: Math.min(Math.max(0, parseInt(rec.score) || 50), 100),
```

```diff
          );
          break;
-       case 'content':
+       case 'content': {
          const sourceContent = allContent.find(item => item.id === request.contextValue);
          if (sourceContent) {
```

```diff
          }
          break;
+       }
      }
      
```

---

Let's add the missing ContentRecommendationRaw interface in the Recommendation.ts file:

---

```diff
    tags?: string[]; // Associated tags
  }
+ 
+ // Raw format as received from OpenAI API response
+ export interface ContentRecommendationRaw {
+   contentId: string;
+   score: string | number;
+   reasoning?: string;
+   category?: string;
+   tags?: string[];
+ }
  
  export interface AIPrompt {
    systemPrompt: string;
    userPrompt: string;
-   contextData?: Record<string, any>;
+   contextData?: Record<string, unknown>;
  }
  
```

---

Now let's run the linter to see if all issues are fixed:

---

```bash
cd StreamVibe && pnpm lint
```

```
At line:1 char:15
+ cd StreamVibe && pnpm lint
+               ~~
The token '&&' is not a valid statement separator in this version.
    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordExce
ption
    + FullyQualifiedErrorId : InvalidEndOfLine


```

---

Let's try the command differently since we're in PowerShell:

---

```bash
cd StreamVibe; pnpm lint
```

```
PS D:\Sanza-TV-App_QuickPoll_v1> cd StreamVibe; pnpm lint

> streamvibe@0.0.0 lint D:\Sanza-TV-App_QuickPoll_v1\StreamVibe


D:\Sanza-TV-App_QuickPoll_v1\StreamVibe\src\components\features\SurpriseMe.tsx
  37:9  warning  The 'generateSurpriseRecommendations' function makes the dependencies of useEffect Hook 
' in its own useCallback() Hook  react-hooks/exhaustive-deps

âœ– 1 problem (0 errors, 1 warning)

PS D:\Sanza-TV-App_QuickPoll_v1\StreamVibe>
```

---

We have one remaining warning in SurpriseMe.tsx. Let's fix it by using useCallback:

---

```diff
- import React, { useState, useEffect } from 'react';
+ import React, { useState, useEffect, useCallback } from 'react';
  import { useNavigate } from 'react-router-dom';
  import RecommendationService from '../../services/RecommendationService';
```

```diff
    const preferencesService = PreferencesService.getInstance();
    
-   const generateSurpriseRecommendations = async () => {
+   const generateSurpriseRecommendations = useCallback(async () => {
      setLoading(true);
      
```

```diff
        setLoading(false);
      }
-   };
+   }, [selectedMood, noveltyLevel, recommendationService]);
    
    // Load surprise recommendations
```

---

Let's run the linter one more time to make sure all issues are fixed:

---

```bash
pnpm lint
```

```
PS D:\Sanza-TV-App_QuickPoll_v1\StreamVibe> pnpm lint

> streamvibe@0.0.0 lint D:\Sanza-TV-App_QuickPoll_v1\StreamVibe

PS D:\Sanza-TV-App_QuickPoll_v1\StreamVibe>
```

---

Great! All lint issues have been fixed. Here's a summary of the changes made:

1. Fixed SurpriseMe.tsx:
   - Added missing dependencies to useEffect hooks
   - Moved generateSurpriseRecommendations function above its usage
   - Wrapped generateSurpriseRecommendations in useCallback to properly handle dependencies

2. Fixed OpenAIService.ts:
   - Replaced 'any' types with 'unknown' for better type safety

3. Fixed PreferencesService.ts:
   - Removed unused 'recentlyWatched' variable
   - Added proper type for the allContent array in analyzeViewingPatterns
   - Added the missing ContentItem import

4. Fixed RecommendationService.ts:
   - Added braces to case blocks to fix lexical declaration errors
   - Replaced 'any' types with the new ContentRecommendationRaw interface

5. Fixed Recommendation.ts:
   - Added a ContentRecommendationRaw interface to handle raw API responses
   - Changed Record<string, any> to Record<string, unknown> for better type safety

All linting issues have been resolved successfully.

---

